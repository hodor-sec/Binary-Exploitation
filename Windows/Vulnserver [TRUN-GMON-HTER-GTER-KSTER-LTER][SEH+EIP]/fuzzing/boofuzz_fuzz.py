#!/usr/bin/python

from boofuzz import *
import sys
import time

def banner(sock):
    sock.recv(1024)

def main():
    session = Session(
    	target = Target(
	    connection = SocketConnection("127.0.0.1", 9999, proto='tcp'),
            procmon_options = {
                "proc_name" : "vulnserver.exe",
                "stop_commands" : ['wmic process where (name="vulnserver.exe") delete'],
                "start_commands" : ['C:\\progs\\vulnserver\\vulnserver.exe'],
            },
            # netmon = pedrpc.client("127.0.0.1", 26001),
            # procmon = pedrpc.client("127.0.0.1", 26002)
	),
    )

    """ Define data model. """
    s_initialize("VulnserverDATA")
    s_group("commands", values=['HELP', 'STATS', 'RTIME', 'LTIME', 'SRUN', 'TRUN', 'GMON', 'GDOG', 'KSTET', 'GTER', 'HTER', 'LTER', 'KSTAN', 'EXIT'])
    s_block_start("CommandBlock", group="commands")
    s_delim(' ')
    s_string('fuzz')
    s_static('\r\n')
    s_block_end()
    
    """ Define state model. """
    session.connect(s_get("VulnserverDATA"))
    
    """ grab the banner from the server """
    session.pre_send = banner
    
    """ start fuzzing - define target and data """
    session.fuzz()

if __name__ == "__main__":
    main()

