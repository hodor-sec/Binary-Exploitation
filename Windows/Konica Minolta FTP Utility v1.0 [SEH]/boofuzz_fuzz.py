#!/usr/bin/env python
from boofuzz import *

host = "192.168.252.10"
port = 21

def banner(sock):
    sock.recv(1024)
    
def main():
    """
    This example is a very simple FTP fuzzer. It uses no process monitory
    (procmon) and assumes that the FTP server is already running.
    """
    
    start_cmd = ['C:\\Program Files (x86)\\KONICA MINOLTA\\FTP Utility\\KMFtp.exe']

    session = Session(
    	target = Target(
	    connection = SocketConnection(host, port, proto='tcp'),
            procmon = pedrpc.Client(host, 26002),
            procmon_options = {
                "proc_name" : "KMFtp.exe",
                "start_commands" : [start_cmd],
                "stop_commands" : ['wmic process where (name="KMFtp.exe") delete'],
            },
	),
        session_filename = "vulnserver.session",
    )
    
    s_initialize("user")
    s_string("USER")
    s_delim(" ")
    s_string("anonymous")
    s_static("\r\n")

    s_initialize("pass")
    s_string("PASS")
    s_delim(" ")
    s_string("james")
    s_static("\r\n")

    s_initialize("stor")
    s_string("STOR")
    s_delim(" ")
    s_string("AAAA")
    s_static("\r\n")

    s_initialize("retr")
    s_string("RETR")
    s_delim(" ")
    s_string("AAAA")
    s_static("\r\n")

    session.connect(s_get("user"))
    session.connect(s_get("user"), s_get("pass"))
    session.connect(s_get("pass"), s_get("stor"))
    session.connect(s_get("pass"), s_get("retr"))

    session.fuzz()

if __name__ == "__main__":
    main()

