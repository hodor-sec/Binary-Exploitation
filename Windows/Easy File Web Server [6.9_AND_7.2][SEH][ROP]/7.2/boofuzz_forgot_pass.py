#!/usr/bin/python

from boofuzz import *
import sys
import time

host = '192.168.252.10'
port = 80
program = 'fsws.exe'

def banner(sock):
    sock.recv(1024)

def main():
    start_cmd = ['C:\\EFS Software\\Easy File Sharing Web Server\\' + program]
    session = Session(
        crash_threshold_element = 600,
        ignore_connection_aborted = True,
        ignore_connection_reset = True,
        target = Target(
	    connection = SocketConnection(host, port, proto='tcp'),
            procmon = pedrpc.Client(host, 26002),
            procmon_options = {
                "proc_name" : program,
                "stop_commands" : ['wmic process where (name="' + program + '") delete'],
                "start_commands" : [start_cmd],
            },
        ),

	session_filename = "efs_ws.session",
    )

    s_initialize(name='HTTP POST FORGOT')
    with s_block("HTTP POST FORGOT-Line"):
		s_static("POST /sendemail.ghp HTTP/1.1\r\n")
		s_static("Host: " + host + "\r\n")
		s_static("Content-Type: application/x-www-form-urlencoded\r\n")
		s_static("User-Agent: Mozilla/5.0\r\n")
		s_static("Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8\r\n")
		s_static("Referer: http://" + host + "/\r\n")
		s_static("Accept-Encoding: gzip, deflate\r\n")
		s_static("Accept-Language: en-US\r\n")
		s_static("Cookie: frmUserName=")
		s_static("; frmUserPass=")
		s_static("; UserID=")
		s_string("1234", name='userid')
		s_delim("; PassWD=")
		s_string("1234", name='passwd')
		s_delim("; SESSIONID=")
		s_string("1234", name='sessionid')
		s_static("\r\n")
		s_static("Connection: close\r\n")
		s_static("\r\n\r\n")
		s_static("Email=")
		s_string("1234", name='email')
		s_delim("&getPassword=", name='getPassword')
		s_string("Get+Password")
		s_static("\r\n\r\n")
	
    session.connect(s_get("HTTP POST FORGOT"))
    session.fuzz()

if __name__ == "__main__":
    main()
