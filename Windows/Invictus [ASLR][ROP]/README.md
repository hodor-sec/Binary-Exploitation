# Invictus POC

As found on [Github](https://github.com/patrickhener/invictus).

## Summary:
  * POC for leaking memory and controlling EIP stackbuffer. Does not use any external Windows library, as shown in initial solution provided above.
  * Exploits the formatting string buffer in "Write File" opcode, leaks memory addresses when read using "Read File" opcode.
  * For EIP control, an overly large file is read directly from a SMB share.

## Caveats: 
  * Uses SMB for payload retrieval; for Win 11 requiring "EnableInsecureGuestLogons" and "AllowInsecureGuestAuth"
  * ROP comment: managed to execute VirtualAlloc eventually by using below odd ROP instruction and compensation unwanted opcodes
`    intbasemain + 0x6868,                   # xchg eax, esp ; sbb eax, 0x18890000 ; add esp, 0x18 ; add eax, 0x04 ; pop ebx ; ret ;`


## Notes:
  * Windows 11 uses a different offset, used hackish solution to improvise

  
### Windows 10
![win10](win10.png)

### Windows 11
![win11](win11.png)
